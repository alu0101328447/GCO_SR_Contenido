<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesar Archivo</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    
    <div class="container mt-5">
        <h1 class="mb-4">Procesar Archivo</h1>

        <div class="form-group col-md-6">
            <label for="fileInput">Selecciona el archivo a procesar:</label>
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="fileInput" accept=".txt"/>
                <label class="custom-file-label" for="fileInput">Elige un archivo...</label>
            </div>
        </div>

        <div class="form-group col-md-6">
            <label for="stopWordsInput">Selecciona el archivo de palabras de parada:</label>
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="stopWordsInput" accept=".txt"/>
                <label class="custom-file-label" for="stopWordsInput">Elige un archivo...</label>
            </div>
        </div>

        <div class="form-group col-md-6">
            <label for="lemmatizationInput">Selecciona el archivo de lematización:</label>
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="lemmatizationInput" accept=".txt"/>
                <label class="custom-file-label" for="lemmatizationInput">Elige un archivo...</label>
            </div>
        </div>

        <div class="form-group col-md-6">
            <button id="processButton" class="btn btn-primary">Procesar</button>
        </div>
    </div>

    <script>
         // Actualiza la etiqueta del archivo seleccionado
         document.getElementById("fileInput").addEventListener("change", function () {
            const fileName = this.files[0] ? this.files[0].name : "Elige un archivo...";
            const label = this.nextElementSibling;
            label.innerText = fileName; // Cambia el texto del label al nombre del archivo
        });

        // Actualiza la etiqueta del archivo seleccionado
        document.getElementById("stopWordsInput").addEventListener("change", function () {
            const fileName = this.files[0] ? this.files[0].name : "Elige un archivo...";
            const label = this.nextElementSibling;
            label.innerText = fileName; // Cambia el texto del label al nombre del archivo
        });

        // Actualiza la etiqueta del archivo seleccionado
        document.getElementById("lemmatizationInput").addEventListener("change", function () {
            const fileName = this.files[0] ? this.files[0].name : "Elige un archivo...";
            const label = this.nextElementSibling;
            label.innerText = fileName; // Cambia el texto del label al nombre del archivo
        });

        class PalabrasManager {
            constructor() {
                this.stopWords = [];
                this.lemmatizationDict = {};
                this.resultados = {};
                this.total = 0;
            }

            cargarStopWords(content) {
                this.stopWords = content.split('\n').map(word => word.trim().toLowerCase()).filter(Boolean);
            }

            cargarLematizacion(content) {
                this.lemmatizationDict = JSON.parse(content);
            }

            esStopWord(palabra) {
                return this.stopWords.includes(palabra);
            }

            lematizar(palabra) {
                return this.lemmatizationDict[palabra] || palabra;
            }

            procesarArchivo(content) {
                // Elimina signos de puntuación excepto el apóstrofe y divide el contenido en palabras
                const palabras = content.replace(/[.,;!?()""]/g, '').split(/\s+/).filter(Boolean); // Divide el contenido en palabras
                this.total = 0;

                palabras.forEach((palabra, indice) => {
                    const palabraLower = palabra.toLowerCase(); // Convertir a minúscula

                    // Comprobar si no es una stop word
                    if (!this.esStopWord(palabraLower)) {
                        const lematizada = this.lematizar(palabraLower);

                        // Comprobar si la palabra lematizada ya existe en resultados
                        if (!this.resultados[lematizada]) {
                            this.resultados[lematizada] = { count: 0, index: indice }; // Guardar el índice de la primera aparición
                        }
                        this.resultados[lematizada].count += 1; // Incrementar el contador
                        this.total ++;
                    }
                });
            }
        }

        const palabrasManager = new PalabrasManager();

        // Función que se ejecuta al pulsar el botón de procesar
        document.getElementById('processButton').addEventListener('click', function() {
            const stopWordsInput = document.getElementById('stopWordsInput');
            const lemmatizationInput = document.getElementById('lemmatizationInput');
            const fileInput = document.getElementById('fileInput');

            // Validar que se hayan seleccionado todos los archivos
            if (stopWordsInput.files.length === 0 || lemmatizationInput.files.length === 0 || fileInput.files.length === 0) {
                alert('Por favor, selecciona todos los archivos necesarios.');
                return;
            }

            // Cargar las palabras de parada
            const stopWordsReader = new FileReader();
            stopWordsReader.onload = function(event) {
                palabrasManager.cargarStopWords(event.target.result); // Cargar stop words

                // Cargar el diccionario de lematización
                const lemmatizationReader = new FileReader();
                lemmatizationReader.onload = function(event) {
                    palabrasManager.cargarLematizacion(event.target.result); // Cargar lematización

                    // Procesar el archivo seleccionado
                    const mainFileReader = new FileReader();
                    mainFileReader.onload = function(event) {
                        const mainFileContent = event.target.result; // Contenido del archivo principal
                        palabrasManager.procesarArchivo(mainFileContent); // Procesar archivo
                        console.log(palabrasManager.resultados); // Muestra el resultado en la consola
                    };

                    mainFileReader.onerror = function(event) {
                        alert('Error al leer el archivo: ' + event.target.error.code);
                    };

                    // Leer el archivo principal
                    mainFileReader.readAsText(fileInput.files[0]); 
                };

                lemmatizationReader.onerror = function(event) {
                    alert('Error al leer el archivo de lematización: ' + event.target.error.code);
                };

                // Leer el archivo de lematización
                lemmatizationReader.readAsText(lemmatizationInput.files[0]); 
            };

            stopWordsReader.onerror = function(event) {
                alert('Error al leer el archivo de palabras de parada: ' + event.target.error.code);
            };

            // Leer el archivo de palabras de parada
            stopWordsReader.readAsText(stopWordsInput.files[0]); 
        });
    </script>
</body>
</html>
